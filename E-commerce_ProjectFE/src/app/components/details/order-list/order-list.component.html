<div class="order-management">
  <h2>All Orders</h2>
 
  <div class="table-container">
    <table class="table">
      <thead>
        <tr>
          <th>Order ID</th>
          <th>User ID</th>
          <th>Order Date</th>
          <th>Delivery Info</th>
          <th>Order Status</th>
          <th>Payment Status</th>
          <th>Total Price</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders" class="fade-in">
          <td>{{ order.orderId }}</td>
          <td>{{ order.userId }}</td>
          <td class="order-date">{{ order.orderDate | date: 'dd MMM, yyyy' }}</td>
         
          <!-- New Delivery Info Column -->
          <td class="delivery-info-cell">
            <div class="delivery-info">
              <div class="delivery-date">
                <strong>{{ getDeliveryDate(order.orderDate) }}</strong>
              </div>
              <div class="delivery-status" 
                   [ngClass]="{
                     'status-delivered': order.orderStatus === 'DELIVERED',
                     'status-cancelled': order.orderStatus === 'CANCELLED',
                     'status-pending': order.orderStatus !== 'DELIVERED' && order.orderStatus !== 'CANCELLED'
                   }">
                {{ getDeliveryStatus(order.orderDate, order.orderStatus) }}
              </div>
            </div>
          </td>
         
          <td>
            <span [ngClass]="getOrderStatusClass(order.orderStatus)" class="status-badge">
              {{ order.orderStatus }}
            </span>
          </td>
         
          <td>
            <span [ngClass]="getPaymentStatusClass(order.paymentStatus)" class="status-badge">
              {{ order.paymentStatus }}
            </span>
          </td>
         
          <td class="currency-amount">{{ order.totalPrice | currency:'INR' }}</td>
         
          <td>
            <div class="action-buttons">
             
              <button
                class="btn-update-order"
                (click)="toggleOrderStatusDropdown(order.orderId)"
                [disabled]="!canEditOrderStatus(order)">
                {{ order.orderStatus === 'DELIVERED' ? 'Delivered' : 'Edit Order' }}
              </button>
             
              <div *ngIf="showOrderStatusDropdown[order.orderId]" class="dropdown-container fade-in">
                <select [(ngModel)]="selectedOrderStatus[order.orderId]">
                  <option *ngFor="let status of orderStatuses" [value]="status">{{ status }}</option>
                </select>
                <button
                  class="btn-apply-order"
                  (click)="updateOrderStatus(order.orderId, selectedOrderStatus[order.orderId])"
                  [disabled]="!canEditOrderStatus(order)">
                  Apply Changes
                </button>
              </div>
             
              <button
                class="btn-update-payment"
                (click)="togglePaymentStatusDropdown(order.orderId)"
                [disabled]="!canEditPaymentStatus(order)">
                {{ order.paymentStatus === 'PAID' ? 'Paid' : 'Edit Payment' }}
              </button>
             
              <div *ngIf="showPaymentStatusDropdown[order.orderId]" class="dropdown-container fade-in">
                <select [(ngModel)]="selectedPaymentStatus[order.orderId]">
                  <option *ngFor="let status of paymentStatuses" [value]="status">{{ status }}</option>
                </select>
                <button
                  class="btn-apply-payment"
                  (click)="updatePaymentStatus(order.orderId, selectedPaymentStatus[order.orderId])"
                  [disabled]="!canEditPaymentStatus(order)">
                  Apply Changes
                </button>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>